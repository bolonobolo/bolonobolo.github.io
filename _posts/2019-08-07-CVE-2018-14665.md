---
layout: single
title: PoC for CVE-2018-14665 (X server)
date: 2019-8-11
classes: wide
header:
  teaser: /assets/images/CVE-2018-14665/X11.svg
tags:
  - Linux
  - RedHat
  - PoC
  - CVE
  - X server
  - bugs
---  
![](/assets/images/CVE-2018-14665/vectorpaint.svg)

## CVE-2018-14665
Here you can find my analisys and PoC for most used Linux distribution. <br>
For now i started from Redhat, this is the link for the official RHSA <br>
[RHSA-2018:3410](https://access.redhat.com/errata/RHSA-2018:3410)

This PoC in published on [exploit-db](https://www.exploit-db.com/exploits/45832)<br>

Here the explanation about how RedHat is wrong when it write this PE is not available by SSH access.<br>
The notes from the original RedHat CVE bulletin indicates that this vulnerability can't be used from remote (for example using SSH)<br>
[RHEL bulletin](https://access.redhat.com/security/cve/cve-2018-14665)<br>
![alt text](/assets/images/CVE-2018-14665/RedHat_statement.png) <br>
<br><br>
The real statement is, using the default SElinux settings and the default configuration about xserver PAM module, the PE can work also with a SSH session.
![alt text](/assets/images/CVE-2018-14665/selinux.png)<br><br>
![alt text](/assets/images/CVE-2018-14665/PAM_xserver.png) <br><br>
The only condition that have to be met for this PE to work via SSH, is that the legitimate non-root user has to be logged in through console at the moment the PE script launched. <br>
It can be easly done via social engeneering or via console acces for example in a VMWare environment.<br>
In fact, during the logged in session of the legitimate non-root user, a file with the name of the non-root user will be created in the `/var/run/console` folder. With that file present, the same non-root user can launch a Xorg command via SSH. <br>
The console folder is empty if nobody is logged via console
![alt text](/assets/images/CVE-2018-14665/console_empty.png)
<br>
so, in this conditions the PE does not work.
![alt text](/assets/images/CVE-2018-14665/xorg_KO.png)
<br>
If a legitimate non-root user, login tru console, so a session opened for the legitimate non-root user.<br>
If we checks the console folder now, we can find a file that have the same name of the non-root user. <br>
![alt text](/assets/images/CVE-2018-14665/login1.png)
<br>
![alt text](/assets/images/CVE-2018-14665/login2.png)
<br>
![alt text](/assets/images/CVE-2018-14665/console_ready.png)
<br>
With the file created the Xorg command can be excuted via SSH and the PE spawn a root shell.<br>
![alt text](/assets/images/CVE-2018-14665/xorg_OK.png)
<br>
![alt text](/assets/images/CVE-2018-14665/xorg_PE.png)
<br>

The exploit is tested on RHEL 7.3 and 7.5 and Xorg version 1.19.5 <br>
![alt text](/assets/images/CVE-2018-14665/rhel_release.png)<br>
![alt text](/assets/images/CVE-2018-14665/rpm-xserver.png)<br>

The PoC published, exploit locally a RHEL 7 and has a very simple usage: python poc.py <br>
![alt text](/assets/images/CVE-2018-14665/exploited.png)<br>

## Links
+ [My repository on Github](https://github.com/bolonobolo/CVE-2018-14665)