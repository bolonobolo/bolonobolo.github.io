---
layout: single
title: PoC for CVE-2018-14665
date: 2019-8-11
classes: wide
header:
  teaser: /assets/images/CVE-2018-14665/X11.svg
tags:
  - Penetration Testing
  - OSCP
  - PWK
  - Offensive Security
  - Review
---  

## CVE-2018-14665
Here you can find my analisys and PoC for most used Linux distribution. <br>
For now i started from Redhat, this is the link for the official RHSA <br>
[RHSA-2018:3410](https://access.redhat.com/errata/RHSA-2018:3410)

This PoC in published on [exploit-db](https://www.exploit-db.com/exploits/45832)<br>

Here the explanation about how RedHat is wrong when it write this PE is not available by SSH access.<br>
###### from the original RedHat CVE bulletin <br>
[RHEL bulletin](https://access.redhat.com/security/cve/cve-2018-14665)<br>
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/RedHat_statement.png) <br>
<br>
The real statement is using the default SElinux settings <br> 
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/selinux.png)<br>
and the default configuration about xserver PAM module <br>
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/PAM_xserver.png) <br>
the PE can work also with a SSH session. <br>
<br>
The only condition that have to be met for this PE to work via SSH, is that the legitimate non-root user has to be logged in through console at the moment the PE script launched. <br>
In fact, during the logged in session of the legitimate non-root user, a file with the name of the non-root user will be created in the `/var/run/console` folder. With that file present, the same non-root user can launch a Xorg command via SSH. <br>
###### the console folder is empty if nobody is logged via console
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/console_empty.png)
<br>
###### in this conditions the PE does not work
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/xorg_KO.png)
<br>
###### login of legitimate non-root user<br>
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/login1.png)
<br>
###### session opened for the legitimate non-root user
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/login2.png)
<br>
###### check the console folder now
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/console_ready.png)
<br>
###### with the file created the Xorg command can be excuted via SSH
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/xorg_OK.png)
<br>
###### and the PE spawn a root shell
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/xorg_PE.png)

The exploit is tested on RHEL 7.3 and 7.5 and Xorg version 1.19.5 <br>
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/rhel_release.png)
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/rpm-xserver.png)

The PoC published here exploit locally a RHEL 7 and has a very simple usage: python poc.py
[](https://github.com/bolonobolo/CVE-2018-14665/blob/master/img/exploited.png)